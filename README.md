# info-process

Copyright (c) 2025 [Antmicro](https://www.antmicro.com)

info-process is a tool processing [LCOV](https://github.com/linux-test-project/lcov)'s `.info` format.
Such files can be used in, e.g., [Coverview](https://github.com/antmicro/coverview) which is a tool for generating coverage dashboards.
The overview of the `.info` format is available in LCOV's `geninfo` manual page (`man geninfo`) in the `FILES` section and [online](https://manpages.debian.org/bookworm/lcov/geninfo.1.en.html#FILES).
Tool is aimed at working with coverage reports generated by running hardware simulations, for example in [Verilator](https://github.com/verilator/verilator).

## Prerequisites

Only Python 3 is required to run the script.

## Using the tool

An overview of available arguments and options can be printed with:

```bash
./info-process.py --help
```

Multiple modifications can be made to the input file by specifying multiple options, e.g.

```bash
./info-process.py --add-two-way-toggles --add-missing-brda-entries coverage-toggles.info
```

will modify the file in-place by adding `BRDA` entries for files with only `DA` entries and additionally covert those `BRDA` into separate entries with both the `0->1` and `1->0` toggle transitions.

### Modifying SF entries

Source file paths in `SF` entries (`SF:<PATH>`) can be stripped based on a regular expression provided with the `--strip-file-prefix <REGEX>` option.
Additionally, records for specific source files can be filtered out based on their paths matching a regular expression provided with the `--filter <REGEX>` option.
For non-matching paths you can use `--filter-out <REGEX>`.
Please note that filtering is performed on stripped paths when these two options are used together.

For example, to strip `/root/designs/` prefixes from `SF` entries in a `coverage-toggles.info` file and only keep records for files from the `/root/designs/unit-tests` directory, one can run:

```bash
./info-process.py --filter 'unit-tests' --strip-file-prefix '.*/designs/' coverage-toggles.info
```

### Normalizing toggle hit counts

Hit counts greater than 1 in `BRDA` and `DA` entries can be replaced with 1 with the `--normalize-hit-counts` option.

For example:
```bash
./info-process.py --normalize-hit-counts coverage-toggles.info
```

will modify the `coverage-toggles.info` file in-place like so:

```diff
BRDA:30,0,toggle_0,1
-BRDA:30,0,toggle_1,27
+BRDA:30,0,toggle_1,1
DA:48,0
-DA:49,159
+DA:49,1
```

### Merging

Multiple `.info` files can be merged using the `info-merge.py` script, e.g.

```bash
./info-merge.py --output coverage-merged.info coverage-test1.info coverage-test2.info coverage-test3.info
```

which will merge `coverage-test1.info`, `coverage-test2.info`, `coverage-test3.info` files and save the result to `coverage-merged.info`.

The output file will contain information merged for matching files based on `SF` paths with:
* recalculated `BRF`, `BRH`, `LF` and `LH` entries,
* `DA` entries with total hits for the given line from the input files,
* `BRDA` entries with total hits for the given line and name from the input files and the highest block ID found for the given name in the input files.

`BRDA` entries for the given line will be sorted lexicographically with proper number handling, i.e., id[0], ..., id[9], id[10]...
This might cause block IDs to be out of order in the output file if they were sorted differently in the input files.

To apply this new order to the block IDs of the merged file, one can use `--set-block-ids` option of the `info-process.py` script:
```bash
./info-process.py --set-block-ids coverage-merged.info
```
